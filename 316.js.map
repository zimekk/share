{"version":3,"file":"316.js","mappings":"yJAGA,MAAMA,EAAqB,uCAkBZ,SAASC,IACtB,MAAMC,GAAMC,EAAAA,EAAAA,QAAO,MAEnB,OACEC,EAAAA,cAAA,WAASC,UAAWC,EAAAA,EAAAA,SAClBF,EAAAA,cAAA,WACEA,EAAAA,cAAA,UACEG,SAASC,EAAAA,EAAAA,cAAYC,UACnB,MAAMC,QAAeC,UAAUC,UAAUC,cAAc,CACrDC,QAAS,CACP,CACEC,KAAM,UAIVC,iBAAkB,CAAChB,KAGrBiB,QAAQC,IAAIR,GAEZA,EAAOS,KACJC,UACAC,MAAKZ,MAAAA,IAGJQ,QAAQC,IAAII,GAELA,EAAOC,kBAAkBvB,MAGjCqB,MAAKZ,MAAAA,WACGe,EAAQC,sBAAsBC,KACnC,EAAGC,WAAAA,EAAYC,KAAAA,EAAMC,MAAAA,KACnBZ,QAAQC,IAAI,CAAES,WAAAA,EAAYC,KAAAA,EAAMC,MAAAA,MAG7BL,EAAQM,kBArDG,2CAwDnBT,MAAMU,GACLA,EAAeC,qBAAqBX,MAAK,KAmBvCU,EAAeE,iBACb,8BACA,EAAGC,OAAAA,MACD,MAAM,MAAEL,GACNK,GApBN,SAAoBL,GAClB,MAAMM,EAAkC,GAArBN,EAAMO,SAAS,GAC5BC,IACFR,EAAMO,SAAS,KAAO,GAAKP,EAAMO,SAAS,KAAO,IAC/CE,GACHT,EAAMO,SAAS,KAAO,GAAKP,EAAMO,SAAS,GAE7CnB,QAAQC,IAAI,CAAEiB,WAAAA,EAAYE,OAAAA,EAAQC,UAAAA,IAElCpC,EAAIqC,QAAQV,MAAQQ,EAEhBC,EAAY,GAAKA,EAAY,KAAQH,GACvCJ,EAAeS,oBAUfC,CAAWZ,aAKpB,KACJ,iBAGDzB,EAAAA,cAAA,SAAOF,IAAKA,EAAKwC,UAAQ,KAE3BtC,EAAAA,cAAA,WACEA,EAAAA,cAAA,KACEuC,KAAK,8FACLT,OAAO,SACPU,IAAI,uBACL,mG,6ECnGLC,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAOC,GAAI,sCAAuC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,gEAAgE,MAAQ,GAAG,SAAW,kBAAkB,eAAiB,CAAC,qCAAqC,WAAa,MAEvRH,EAAwBI,OAAS,CAChC,QAAW,wBAEZ,W,gKCCIC,EAAU,GAEdA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IAElBF,EAAQG,OAAS,SAAc,KAAM,QAE3CH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB,IAE7B,IAAIC,EAAS,IAAI,UAASN,GAIxB,IAAK,kBAAkBH,EAAOU,IAAIC,WAAY,CAC5C,IA+BIC,GAAiB,iBACjBC,EAAYD,EAAgB,EAAc,iBAE9CZ,EAAOU,IAAII,OACT,MACA,cApCkB,SAAuBC,EAAGC,EAAGJ,GACnD,IAAKG,GAAKC,GAAKD,IAAMC,EACnB,OAAO,EAGT,IAAIC,EAEJ,IAAKA,KAAKF,EACR,KAAIH,GAAuB,YAANK,IAKjBF,EAAEE,KAAOD,EAAEC,GACb,OAAO,EAIX,IAAKA,KAAKD,EACR,KAAIJ,GAAuB,YAANK,GAKhBF,EAAEE,IACL,OAAO,EAIX,OAAO,EAQIC,CAAcL,EAAWD,EAAgB,EAAc,iBAAgBA,IAMtEC,EAAYD,EAAgB,EAAc,iBAE1CH,EAAO,YAPLT,EAAOU,IAAIC,gBAYzBX,EAAOU,IAAIS,SAAQ,WACjBV,OAMG,QAAe,WAAW,iBAAiB,sBAAiBW","sources":["webpack://@dev/app/../scale/src/containers/Scale/index.tsx","webpack://@dev/app/../scale/src/containers/Scale/styles.module.scss","webpack://@dev/app/../scale/src/containers/Scale/styles.module.scss?647d"],"sourcesContent":["import React, { useCallback, useRef } from \"react\";\nimport styles from \"./styles.module.scss\";\n\nconst controlServiceUUID = \"0000181b-0000-1000-8000-00805f9b34fb\";\nconst commandCharacteristicUUID = \"00002a9c-0000-1000-8000-00805f9b34fb\";\n// const controlServiceUUID = 'ebe0ccb0-7a0a-4b0c-8a1a-6ff2997da3a6';\n// const commandCharacteristicUUID = 'ebe0ccc1-7a0a-4b0c-8a1a-6ff2997da3a6';\n\n// https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/web-bluetooth/web-bluetooth-tests.ts\nfunction tempValue(value: DataView) {\n  let sign = value.getUint8(1) & (1 << 7);\n  let temp = ((value.getUint8(1) & 0x7f) << 8) | value.getUint8(0);\n  if (sign) temp = temp - 32767;\n  const temperature = temp / 100;\n  const humidity = value.getUint8(2);\n  console.log({\n    temperature, // Â°C\n    humidity, // %\n  });\n}\n\nexport default function Section() {\n  const ref = useRef(null);\n\n  return (\n    <section className={styles.Section}>\n      <div>\n        <button\n          onClick={useCallback(async () => {\n            const device = await navigator.bluetooth.requestDevice({\n              filters: [\n                {\n                  name: \"MIBCS\",\n                },\n              ],\n              // acceptAllDevices: true,\n              optionalServices: [controlServiceUUID],\n            });\n\n            console.log(device);\n\n            device.gatt\n              .connect()\n              .then(async (server) => {\n                // Step 3: Get the Service\n                // serverInstance = server;\n                console.log(server);\n                // console.log(await server.getPrimaryServices())\n                return server.getPrimaryService(controlServiceUUID);\n                // console.log(\"Getting PrimaryService\");\n              })\n              .then(async (service) => {\n                (await service.getCharacteristics()).map(\n                  ({ properties, uuid, value }) =>\n                    console.log({ properties, uuid, value })\n                );\n\n                return service.getCharacteristic(commandCharacteristicUUID);\n                // console.log(\"Getting Characteristic\");\n              })\n              .then((characteristic) =>\n                characteristic.startNotifications().then(() => {\n                  // https://github.com/limhenry/web-bluetooth-mi-scale/blob/master/main.js\n                  // https://github.com/lolouk44/xiaomi_mi_scale/blob/master/src/Xiaomi_Scale.py\n                  function scaleValue(value: DataView) {\n                    const stabilized = value.getUint8(1) & (1 << 5);\n                    const weight =\n                      ((value.getUint8(12) << 8) + value.getUint8(11)) / 200;\n                    const impedance =\n                      (value.getUint8(10) << 8) + value.getUint8(9);\n\n                    console.log({ stabilized, weight, impedance });\n\n                    ref.current.value = weight;\n\n                    if (impedance > 0 && impedance < 3000 && stabilized) {\n                      characteristic.stopNotifications();\n                    }\n                  }\n\n                  characteristic.addEventListener(\n                    \"characteristicvaluechanged\",\n                    ({ target }) => {\n                      const { value } =\n                        target as BluetoothRemoteGATTCharacteristic;\n                      // tempValue(value)\n                      scaleValue(value);\n                    }\n                  );\n                })\n              );\n          }, [])}\n        >\n          start measure\n        </button>\n        <input ref={ref} readOnly />\n      </div>\n      <div>\n        <a\n          href=\"https://dev.to/henrylim96/reading-xiaomi-mi-scale-data-with-web-bluetooth-scanning-api-1mb9\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          https://dev.to/henrylim96/reading-xiaomi-mi-scale-data-with-web-bluetooth-scanning-api-1mb9\n        </a>\n      </div>\n    </section>\n  );\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".Lf7jef6Y2X3W2I6Y0DRi{color:purple}\", \"\",{\"version\":3,\"sources\":[\"webpack://./../scale/src/containers/Scale/styles.module.scss\"],\"names\":[],\"mappings\":\"AAAA,sBACE,YAAA\",\"sourcesContent\":[\".Section {\\n  color: purple;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"Section\": \"Lf7jef6Y2X3W2I6Y0DRi\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\nif (module.hot) {\n  if (!content.locals || module.hot.invalidate) {\n    var isEqualLocals = function isEqualLocals(a, b, isNamedExport) {\n  if (!a && b || a && !b) {\n    return false;\n  }\n\n  var p;\n\n  for (p in a) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (a[p] !== b[p]) {\n      return false;\n    }\n  }\n\n  for (p in b) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (!a[p]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n    var isNamedExport = !content.locals;\n    var oldLocals = isNamedExport ? namedExport : content.locals;\n\n    module.hot.accept(\n      \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\",\n      function () {\n        if (!isEqualLocals(oldLocals, isNamedExport ? namedExport : content.locals, isNamedExport)) {\n                module.hot.invalidate();\n\n                return;\n              }\n\n              oldLocals = isNamedExport ? namedExport : content.locals;\n\n              update(content);\n      }\n    )\n  }\n\n  module.hot.dispose(function() {\n    update();\n  });\n}\n\n\nexport * from \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n       export default content && content.locals ? content.locals : undefined;\n"],"names":["controlServiceUUID","Section","ref","useRef","React","className","styles","onClick","useCallback","async","device","navigator","bluetooth","requestDevice","filters","name","optionalServices","console","log","gatt","connect","then","server","getPrimaryService","service","getCharacteristics","map","properties","uuid","value","getCharacteristic","characteristic","startNotifications","addEventListener","target","stabilized","getUint8","weight","impedance","current","stopNotifications","scaleValue","readOnly","href","rel","___CSS_LOADER_EXPORT___","push","module","id","locals","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","update","hot","invalidate","isNamedExport","oldLocals","accept","a","b","p","isEqualLocals","dispose","undefined"],"sourceRoot":""}