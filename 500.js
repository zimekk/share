(self.webpackChunk_dev_app=self.webpackChunk_dev_app||[]).push([[500],{9082:(e,n,t)=>{"use strict";t.d(n,{L:()=>o,V:()=>a});var s=t(6145),r=t(9385);const o=new s.g6(`${location.pathname}graphql`,{headers:{}}),a=(0,r.eI)({url:`${{"https:":"wss:"}[location.protocol]||"ws:"}//${location.host}${location.pathname}subscriptions`})},216:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>m});var s=t(2784),r=t(3115),o=t.n(r),a=t(6145),l=t(7598),i=t(3919),c=t(9082),u=t(517);class d{client=c.L;subscriptions=c.V}const f=a.Ps`
  subscription SignalSubscription {
    signal {
      sdp
      type
      candidate {
        candidate
        sdpMLineIndex
        sdpMid
      }
    }
  }
`,g=a.Ps`
  mutation SendSignalMutation($signal: SignalInput) {
    sendSignal(signal: $signal)
  }
`,p=new class extends d{sendSignal(e){return(0,l.D)(this.client.request(g,{signal:e}))}onSignal(){return new i.y((e=>this.subscriptions.subscribe({query:f},{next:({data:n,errors:t})=>t?e.error(t[0]):e.next(n),error:n=>e.error(n),complete:()=>e.complete()})))}};function m(){const[e,{sendSignal:n}]=function(){const[e,n]=(0,s.useState)({hello:null});return(0,s.useEffect)((()=>{const e=[p.onSignal().subscribe((({signal:e})=>n((n=>({...n,signal:e})))))];return()=>{e.map((e=>e.unsubscribe()))}}),[]),[e,{sendSignal:e=>p.sendSignal(e)}]}(),[t,r]=(0,s.useState)(void 0),[a,l]=(0,s.useState)(null),i=(0,s.useRef)(null),c=(0,s.useRef)(null),d=(0,s.useRef)(null);return(0,s.useEffect)((()=>{if(e&&i.current){const{type:n}=e.signal;if("offer"===n&&t)return;if("answer"===n&&!t)return;console.log(["peer.signal"],e.signal),i.current.signal(e.signal)}}),[e,i,t]),(0,s.useEffect)((()=>{void 0!==t&&(console.log({initiator:t}),Promise.resolve().then((()=>t?navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1}):Promise.resolve(null))).then((e=>{l(e);const s=new(o())({initiator:t,stream:e,trickle:!1,reconnectTimer:1e3,iceTransportPolicy:"relay",config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.services.mozilla.com"}]}}).on("signal",(e=>{console.log(["signal",t],{data:e}),n(e)})).on("stream",(e=>{console.log(["stream",t],{stream:e}),Object.assign(d.current,{srcObject:e})})).on("error",(function(e){console.log(["error",t],{error:e})}));i.current=s})).catch(console.error))}),[t]),(0,s.useEffect)((()=>{if(a){const e=a.getVideoTracks();return console.log({stream:a,videoTracks:e}),Object.assign(c.current,{srcObject:a}),()=>{a.getTracks().forEach((e=>e.stop()))}}}),[a]),s.createElement("div",{className:u.Z.Video},s.createElement("button",{onClick:()=>r(!0)},"setInitiator(true)"),s.createElement("button",{onClick:()=>r(!1)},"setInitiator(false)"),s.createElement("video",{ref:c,width:"200",autoPlay:!0,muted:!0,playsInline:!0}),s.createElement("video",{ref:d,width:"200",autoPlay:!0,muted:!0}))}},5864:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l});var s=t(272),r=t.n(s),o=t(2609),a=t.n(o)()(r());a.push([e.id,".kvevXXBTh098bMXqbTDA{color:green}","",{version:3,sources:["webpack://./../video/src/containers/Video/styles.module.scss"],names:[],mappings:"AAAA,sBACE,WAAA",sourcesContent:[".Video {\n  color: green;\n}\n"],sourceRoot:""}]),a.locals={Video:"kvevXXBTh098bMXqbTDA"};const l=a},517:(e,n,t)=>{"use strict";t.d(n,{Z:()=>k});var s=t(6062),r=t.n(s),o=t(4036),a=t.n(o),l=t(6793),i=t.n(l),c=t(7892),u=t.n(c),d=t(1173),f=t.n(d),g=t(2464),p=t.n(g),m=t(5864),v={};v.styleTagTransform=p(),v.setAttributes=u(),v.insert=i().bind(null,"head"),v.domAPI=a(),v.insertStyleElement=f();var b=r()(m.default,v);if(!m.default.locals||e.hot.invalidate){var h=!m.default.locals,S=h?m:m.default.locals;e.hot.accept(5864,(n=>{m=t(5864),function(e,n,t){if(!e&&n||e&&!n)return!1;var s;for(s in e)if((!t||"default"!==s)&&e[s]!==n[s])return!1;for(s in n)if(!(t&&"default"===s||e[s]))return!1;return!0}(S,h?m:m.default.locals,h)?(S=h?m:m.default.locals,b(m.default)):e.hot.invalidate()}))}e.hot.dispose((function(){b()}));const k=m.default&&m.default.locals?m.default.locals:void 0},4854:()=>{},6602:()=>{}}]);
//# sourceMappingURL=500.js.map