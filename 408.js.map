{"version":3,"file":"408.js","mappings":"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","sources":["webpack://@dev/app/../client/src/index.ts","webpack://@dev/app/../mihome/src/containers/index.tsx","webpack://@dev/app/../mihome/src/containers/styles.module.scss","webpack://@dev/app/../../node_modules/rxjs/dist/esm5/internal/operators/map.js","webpack://@dev/app/../mihome/src/containers/styles.module.scss?9390"],"sourcesContent":["import { GraphQLClient } from \"graphql-request\";\nimport { createClient } from \"graphql-ws\";\n\n// https://shammelburg.medium.com/subscriptions-with-graphql-dfa8279af050\n// https://github.com/shammelburg/graphql-rxjs-angular/blob/main/src/app/services/graphql.service.ts\nexport const client = new GraphQLClient(`${location.pathname}graphql`, {\n  headers: {\n    // authorization: `Bearer ${localStorage.getItem('token')}`,\n  },\n});\n\nexport const subscriptions = createClient({\n  url: `${{ \"https:\": \"wss:\" }[location.protocol] || \"ws:\"}//${location.host}${\n    location.pathname\n  }subscriptions`,\n});\n","import React, {\n  type ChangeEventHandler,\n  useCallback,\n  useEffect,\n  useState,\n} from \"react\";\nimport { gql } from \"graphql-request\";\nimport { from } from \"rxjs\";\nimport { map } from \"rxjs/operators\";\nimport { client, subscriptions } from \"@dev/client\";\nimport styles from \"./styles.module.scss\";\n\nclass Service {\n  client = client;\n  subscriptions = subscriptions;\n}\n\nconst MIHOME_DEVICES = gql`\n  query MiHomeDevicesQuery($username: String, $password: String) {\n    miHome {\n      devices(username: $username, password: $password)\n    }\n  }\n`;\n\nconst MIHOME_DEVICE = gql`\n  query MiHomeDeviceQuery($did: String) {\n    miHome {\n      device(did: $did)\n    }\n  }\n`;\n\nexport class MiHomeService extends Service {\n  miHomeDevices(data) {\n    return from(this.client.request(MIHOME_DEVICES, data)).pipe(\n      map(({ miHome: { devices } }) => devices)\n    );\n  }\n  miHomeDevice(data) {\n    return from(this.client.request(MIHOME_DEVICE, data)).pipe(\n      map(({ miHome: { device } }) => device)\n    );\n  }\n}\n\nconst service = new MiHomeService();\n\ninterface Device {\n  did: string;\n  token: string;\n  name: string;\n  localip: string;\n  mac: string;\n  ssid: string;\n  model: string;\n  isOnline: boolean;\n  desc: string;\n}\n\nexport function useService() {\n  const [data, setData] = useState<Device[] | null>(() => []);\n\n  return {\n    data,\n    miHomeDevices: useCallback(\n      (data) => service.miHomeDevices(data).subscribe((data) => setData(data)),\n      []\n    ),\n    miHomeDevice: useCallback((data) => service.miHomeDevice(data), []),\n  };\n}\n\nfunction Controls({ item, miHomeDevice }: { item: Device; miHomeDevice: any }) {\n  useEffect(() => {\n    handleClick;\n  }, [item]);\n  const handleClick = useCallback(() => miHomeDevice({ did: item.did }), []);\n  return (\n    <div>\n      <button onClick={handleClick}>device</button>\n    </div>\n  );\n}\n\nexport default function Section() {\n  const [form, setForm] = useState(() => ({\n    username: process.env.MI_USERNAME || \"\",\n    password: process.env.MI_PASSWORD || \"\",\n  }));\n  const { data, miHomeDevices, miHomeDevice } = useService();\n\n  const handleChange = useCallback<ChangeEventHandler<HTMLInputElement>>(\n    ({ target }) =>\n      setForm((form) => ({\n        ...form,\n        [target.name]: target.value,\n      })),\n    []\n  );\n\n  const handleSubmit = useCallback<ChangeEventHandler<HTMLFormElement>>((e) => {\n    e.preventDefault();\n    miHomeDevices(form);\n  }, []);\n\n  return (\n    <div className={styles.Section}>\n      <h2>MiHome</h2>\n      <form onSubmit={handleSubmit}>\n        <label>\n          <div>username</div>\n          <input\n            name=\"username\"\n            type=\"text\"\n            value={form.username}\n            onChange={handleChange}\n          />\n        </label>\n        <label>\n          <div>password</div>\n          <input\n            name=\"username\"\n            type=\"text\"\n            value={form.password}\n            onChange={handleChange}\n          />\n        </label>\n        <div>\n          <button type=\"submit\">get-devices</button>\n        </div>\n      </form>\n      {data && (\n        <table>\n          <tbody>\n            <tr>\n              <th>name</th>\n              <th>localip</th>\n              <th>ssid</th>\n              <th>model</th>\n              <th>desc</th>\n              <th>controls</th>\n            </tr>\n            {data.map((item) => (\n              <tr key={item.did}>\n                <td>{item.name}</td>\n                <td>{item.localip}</td>\n                <td>{item.ssid}</td>\n                <td>{item.model}</td>\n                <td>{item.desc}</td>\n                <td>\n                  <Controls item={item} miHomeDevice={miHomeDevice} />\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      )}\n      <pre>{JSON.stringify(data, null, 2)}</pre>\n    </div>\n  );\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".djYXgIaK28izYtaJwauC{color:green}.djYXgIaK28izYtaJwauC table{border-collapse:collapse;width:100%}.djYXgIaK28izYtaJwauC th,.djYXgIaK28izYtaJwauC td{padding:.25em;text-align:left}\", \"\",{\"version\":3,\"sources\":[\"webpack://./../mihome/src/containers/styles.module.scss\"],\"names\":[],\"mappings\":\"AAAA,sBACE,WAAA,CAEA,4BACE,wBAAA,CACA,UAAA,CAEF,kDAEE,aAAA,CACA,eAAA\",\"sourcesContent\":[\".Section {\\n  color: green;\\n\\n  table {\\n    border-collapse: collapse;\\n    width: 100%;\\n  }\\n  th,\\n  td {\\n    padding: 0.25em;\\n    text-align: left;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"Section\": \"djYXgIaK28izYtaJwauC\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","import { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nexport function map(project, thisArg) {\n    return operate(function (source, subscriber) {\n        var index = 0;\n        source.subscribe(createOperatorSubscriber(subscriber, function (value) {\n            subscriber.next(project.call(thisArg, value, index++));\n        }));\n    });\n}\n//# sourceMappingURL=map.js.map","\n      import API from \"!../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\nif (module.hot) {\n  if (!content.locals || module.hot.invalidate) {\n    var isEqualLocals = function isEqualLocals(a, b, isNamedExport) {\n  if (!a && b || a && !b) {\n    return false;\n  }\n  var p;\n  for (p in a) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n    if (a[p] !== b[p]) {\n      return false;\n    }\n  }\n  for (p in b) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n    if (!a[p]) {\n      return false;\n    }\n  }\n  return true;\n};\n    var isNamedExport = !content.locals;\n    var oldLocals = isNamedExport ? namedExport : content.locals;\n\n    module.hot.accept(\n      \"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\",\n      function () {\n        if (!isEqualLocals(oldLocals, isNamedExport ? namedExport : content.locals, isNamedExport)) {\n                module.hot.invalidate();\n\n                return;\n              }\n\n              oldLocals = isNamedExport ? namedExport : content.locals;\n\n              update(content);\n      }\n    )\n  }\n\n  module.hot.dispose(function() {\n    update();\n  });\n}\n\n\nexport * from \"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n       export default content && content.locals ? content.locals : undefined;\n"],"names":["client","GraphQLClient","location","pathname","headers","subscriptions","createClient","url","protocol","host","MIHOME_DEVICES","gql","MIHOME_DEVICE","service","miHomeDevices","data","from","this","request","pipe","map","miHome","devices","miHomeDevice","device","Controls","item","useEffect","handleClick","useCallback","did","React","onClick","Section","form","setForm","useState","username","password","setData","subscribe","useService","handleChange","target","name","value","handleSubmit","e","preventDefault","className","styles","onSubmit","type","onChange","key","localip","ssid","model","desc","JSON","stringify","___CSS_LOADER_EXPORT___","push","module","id","locals","project","thisArg","source","subscriber","index","next","call","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","update","hot","invalidate","isNamedExport","oldLocals","accept","a","b","p","isEqualLocals","dispose","undefined"],"sourceRoot":""}