{"version":3,"file":"552.js","mappings":"oJAKO,MAAMA,EAAS,IAAIC,EAAAA,cAAe,GAAEC,SAASC,kBAAmB,CACrEC,QAAS,KAKEC,GAAgBC,EAAAA,EAAAA,IAAa,CACxCC,IAAM,GAAE,CAAE,SAAU,QAASL,SAASM,WAAa,UAAUN,SAASO,OACpEP,SAASC,2B,6GCRb,MAAMO,EAAkBC,EAAAA,GAAI;;;;EAMtBC,EAAsBD,EAAAA,GAAI;;;;EAM1BE,EAAmBF,EAAAA,GAAI;;;;;;;;EAUvBG,EAAYH,EAAAA,GAAI;;;;;;ECxBhBI,EAAgB,IDqCf,cALA,MACLf,OAASA,EAAAA,EACTK,cAAgBA,EAAAA,GAIhBW,eAAeC,GACb,OAAOC,EAAAA,EAAAA,GAAKC,KAAKnB,OAAOoB,QAAQV,EAAiB,CAAEO,YAAAA,KAGrDI,mBAAmBC,GACjB,OAAOJ,EAAAA,EAAAA,GAAKC,KAAKnB,OAAOoB,QAAQR,EAAqB,CAAEU,IAAAA,KAGzDC,kBACE,OAAOL,EAAAA,EAAAA,GAAKC,KAAKnB,OAAOoB,QAAQP,IAAmBW,MACjDC,EAAAA,EAAAA,IAAI,EAAGF,gBAAAA,KAAsBA,KAIjCG,WACE,OAAO,IAAIC,EAAAA,GAAYC,GACrBT,KAAKd,cAAcwB,UACjB,CAAEC,MAAOhB,GACT,CACEiB,KAAM,EAAGC,KAAAA,EAAMC,OAAAA,KACbA,EAASL,EAASM,MAAMD,EAAO,IAAML,EAASG,KAAKC,GACrDE,MAAQA,GAAUN,EAASM,MAAMA,GACjCC,SAAU,IAAMP,EAASO,iB,wBE7CnC,SAASC,GAAa,mBACpBf,EAAkB,aAClBgB,IAIA,MAAOC,EAAUC,IAAeC,EAAAA,EAAAA,WAAmB,IAAM,KAEzD,OACE,2BAASC,UAAWC,EAAAA,EAAAA,cAClB,6BACE,6BACE,0BACE,0BACE,yBACEC,KAAK,WACLC,QAASN,EAASO,SAAWR,EAAaQ,OAC1CC,UAAUC,EAAAA,EAAAA,cACR,EAAGC,OAAAA,KACDT,EACES,EAAOJ,QAAUP,EAAaZ,KAAI,EAAGwB,GAAAA,KAASA,IAAM,KAExD,OAIN,kCACA,yCACA,uCAEDZ,EAAaZ,KAAI,CAACyB,EAAMC,IAAM,CAC7B,sBAAIC,IAAKD,GACP,0BACE,yBACER,KAAK,WACLC,QAASN,EAASe,SAASH,EAAKD,IAChCH,UAAUC,EAAAA,EAAAA,cACR,EAAGC,OAAAA,KACDT,GAAaD,GACVU,EAAOJ,QAEJN,EAASgB,OAAOJ,EAAKD,IADrBX,EAASiB,QAAQN,GAAOA,IAAOC,EAAKD,QAG5C,OAIN,2BAAKO,EAAAA,EAAAA,GAAOC,OAAOP,EAAKQ,MAAO,yBAC/B,sBAAIC,MAAM,SACN,GAAE,IAAIC,KAAKC,aAAa,QAAS,CACjCC,sBAAuB,IACtBN,OAAON,EAAKa,kBAEjB,sBAAIJ,MAAM,SACN,GAAE,IAAIC,KAAKC,aAAa,QAAS,CACjCC,sBAAuB,IACtBN,OAAON,EAAKc,oBAMzB,0BACEC,SAA8B,IAApB3B,EAASO,OACnBqB,SAASnB,EAAAA,EAAAA,cACP,IAAM1B,EAAmBiB,IACzB,CAACA,KACD,uBAQK,SAAS6B,GAAO,eAC7BnD,EAAc,mBACdK,EAAkB,aAClBgB,IAEA,MAAM+B,GAAOC,EAAAA,EAAAA,UACX,IACEhC,GACAA,EACGZ,KAAKyB,IAAI,CAAQD,GAAIC,EAAKQ,KAAMA,KAAMD,OAAOP,EAAKQ,SAAUR,MAC5DoB,MAAK,CAACC,EAAGC,IAAMA,EAAEd,KAAOa,EAAEb,QAC/B,CAACrB,IAGH,OACE,+BACE,4CACA,0BACE6B,SAASnB,EAAAA,EAAAA,cACP,IACE/B,EAAe,CAAE0C,KAAMe,KAAKC,MAAOX,YAAa,GAAIC,SAAU,MAChE,KACA,kBAIc,OAAjB3B,EACC,yCAEA,gBAACD,EAAY,CACXf,mBAAoBA,EACpBgB,aAAc+B,K,cCtHxB,MAAMO,EAASC,QAAQC,IACjBC,EAAUH,EACVI,EAAYJ,EAElB,SAASK,EAAY9C,GACnB0C,QAAQ1C,MAAMA,GAYhB,SAAS+C,IACPL,QAAQC,IAAI,iBA2Dd,IAAIK,EACAC,EACAC,EAkDAC,EACAC,EACAC,EA2BAC,EACAC,EA/BAC,EAAkB,KAKtB,SAASC,EAAU3E,GACjB0E,EAAgBE,KACbC,UACAC,MAAMC,IACLjB,EAAQ,qBACRO,EAAaU,EACNV,EAAWW,kBAChB,2CAGHF,MAAMG,IACLnB,EAAQ,iBACRQ,EAAaW,EACNX,EAAWY,kBAChB,2CAGHJ,MAAMK,IACLrB,EAAQ,8BACRS,EAAsBY,EAS5B,SAAkBnF,GAChBqE,EACGe,qBACAN,MAAMO,IACLb,GAAY,EACZC,GAAgB,EAChB,IAAK,IAAItC,EAAI,EAAGA,EAAIkD,EAASxD,OAAQM,IACnCyB,QAAQC,IAAI,aAAewB,EAASlD,GAAGmD,MACf,wCAApBD,EAASlD,GAAGmD,OACdd,GAAY,GACU,wCAApBa,EAASlD,GAAGmD,OACdb,GAAgB,GAEhBD,GACFb,EAAO,2BACPI,EAAU,2BA/FlB,SAAkB/D,GAChBqE,EACGW,kBAAkB,wCAClBF,MAAMG,IACLnB,EAAQ,sBACRI,EAAce,EACPf,EAAYgB,kBACjB,2CAGHJ,MAAMK,IACLrB,EAAQ,oCACRK,EAA2BgB,EACpBjB,EAAYgB,kBACjB,2CAGHJ,MAAMK,IACLrB,EAAQ,6BACRM,EAAkBe,EACXf,EAAgBmB,qBAAqBT,MAAK,KAC/CV,EAAgBoB,iBACd,8BACCC,IACC,IAAIC,EAAQD,EAAMzD,OAAO0D,MACzB9B,QAAQC,IAAI,CAAE6B,MAAAA,IACd,IAAIC,EAA4B,IAArBD,EAAME,SAAS,GACtBC,GAA6B,IAApBH,EAAME,SAAS,KAAc,EAAKF,EAAME,SAAS,GAC1DD,IAAME,GAAc,OACxBA,GAAc,IACd,IAAIC,EAAOJ,EAAME,SAAS,GACtBG,EAAiB,cAAgBF,EAAO,QAAUC,EAAO,IAC7DE,SAASC,eAAe,gBAAgBC,UAAYH,EACpDjC,EAAQiC,GACR/F,EAAe,CACb0C,KAAMe,KAAKC,MACXX,YAAa8C,EACb7C,SAAU8C,aAOnBK,MAAMnC,GAoDHoC,CAASpG,IACAyE,GACTd,EAAO,4BACPI,EAAU,8BAGVJ,EAAO,aACPI,EAAU,iBAGboC,MAAMnC,GAlCLqC,CAASrG,MAEVmG,MAAMnC,GAmCI,SAASb,IACtB,OAAO,aAAE9B,EAAY,OAAEiF,IAAU,eAAEtG,EAAc,mBAAEK,IFhM9C,WACL,OAAO,aAAEgB,EAAY,OAAEiF,GAAUC,IAAY/E,EAAAA,EAAAA,WAAS,KAAM,CAC1DH,aAAc,KACdiF,OAAQ,SAwBV,OArBAE,EAAAA,EAAAA,YAAU,KACR,MAAMnH,EAAgB,CACpBU,EAAcW,WAAWG,WAAU,EAAG4F,OAAAA,KACpCF,GAAS,EAAGD,OAAAA,KAAWI,MAAY,IAC9BA,EACHJ,QAASA,GAAU,IAAIhE,OAAO,CAACmE,WAWrC,OANA1G,EACGQ,kBACAM,WAAWQ,GACVkF,GAAUG,IAAK,IAAWA,EAAOrF,aAAAA,QAG9B,KACLhC,EAAcoB,KAAKkG,GAAOA,EAAGC,mBAE9B,IAEI,CACL,CAAEvF,aAAAA,EAAciF,OAAAA,GAChB,CACEtG,eAAiBgB,GAASjB,EAAcC,eAAegB,GACvDX,mBAAqBW,GAASjB,EAAcM,mBAAmBW,KEkKjE6F,GACFjD,QAAQC,IAAI,CAAExC,aAAAA,EAAciF,OAAAA,KAE5BE,EAAAA,EAAAA,YAAU,QAAU,IAEpB,MAAMM,GAAc/E,EAAAA,EAAAA,cACjB0D,IACyB,OAApBf,GAA0BA,EAAgBE,KAAKmC,aAEnDpD,EAAO,aAEPgB,EAAU3E,KAEZ,CAACA,IAGGgH,GAAYjF,EAAAA,EAAAA,cACf0D,IAEC,MAAMwB,EAAgB,CACpBC,QAAS,CACP,CAAEC,KAAM,cACR,CACE9B,SAAU,CAAC,SAWf+B,iBAAkB,CAChB,uCACA,uCACA,MACA,OAIJC,UAAUC,UAAUC,kBAAkBzC,MAAM0C,IACtCA,GAEFH,UAAUC,UACPG,cAAcR,GACdnC,MAAM4C,IACL9D,QAAQC,IAAI,CAAE6D,OAAAA,IACdhD,EAAkBgD,EA5NhC,SAA4BA,GAC1B,MAAMC,EAAkB,IAAIC,gBAC5BF,EAAOlC,iBACL,yBACCC,IACC7B,QAAQC,IAAI,gCAAkC6D,EAAOP,KAAO,QAC5D1B,EAAMoC,YAAYC,SAASC,IACzB,MAAMC,EAAS,IAAIC,WAAWF,EAAcC,QAC5CpE,QAAQC,IAAImE,EAAQN,EAAQjC,GACT,cAAfiC,EAAOP,OACTvD,QAAQC,IACN,kBACAmE,EAAO,IAAIE,SAAS,IACpBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,KAErBlC,SAASC,eAAe,OAAOC,UAC7B,mBACA8B,EAAO,IAAIE,SAAS,IACpBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,KAEnBR,EAAOP,KAAKgB,WAAW,QACzBvE,QAAQC,IACN,WACAmE,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,KAErBlC,SAASC,eAAe,OAAOC,UAC7B,YACA8B,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,IACnBF,EAAO,GAAGE,SAAS,KAErBtE,QAAQC,IAAI,oCAGhB8D,EAAgBS,UAElB,CAAEC,MAAM,IAyKEC,CAAmBZ,GACnBhD,EAAgBc,iBACd,yBACAvB,GAEFN,EAAO,kBAAoBe,EAAgByC,MAC3CxC,EAAU3E,MAEXmG,MAAMnC,QAIf,CAAChE,IAGH,OACE,2BAASyB,UAAWC,EAAAA,EAAAA,SAClB,0CACA,0BAAQwB,QAAS8D,GAAU,WAC3B,0BAAQ9D,QAAS4D,GAAY,aAC7B,gBAAC,EAAY,CACX9G,eAAgBA,EAChBK,mBAAoBA,EACpBgB,aAAcA,IAEhB,wBAAMY,GAAG,iBACT,wBAAMA,GAAG,QACG,OAAXqE,EACC,yCAEAA,EAAO7F,KAAI,CAACyB,EAAME,IAAQ,uBAAKA,IAAKA,GAAMmG,KAAKC,UAAUtG,S,6ECnR7DuG,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAO1G,GAAI,oUAAqU,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,4EAA4E,MAAQ,GAAG,SAAW,gGAAgG,eAAiB,CAAC,mVAAmV,WAAa,MAE77BwG,EAAwBG,OAAS,CAChC,aAAgB,wBAEjB,W,6ECPIH,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAO1G,GAAI,sCAAuC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,+DAA+D,MAAQ,GAAG,SAAW,kBAAkB,eAAiB,CAAC,qCAAqC,WAAa,MAEtRwG,EAAwBG,OAAS,CAChC,QAAW,wBAEZ,W,gKCCIC,EAAU,GAEdA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IAElBF,EAAQG,OAAS,SAAc,KAAM,QAE3CH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB,IAE7B,IAAIC,EAAS,IAAI,UAASN,GAIxB,IAAK,kBAAkBF,EAAOS,IAAIC,WAAY,CAC5C,IA+BIC,GAAiB,iBACjBC,EAAYD,EAAgB,EAAc,iBAE9CX,EAAOS,IAAII,OACT,MACA,cApCkB,SAAuBjG,EAAGC,EAAG8F,GACnD,IAAK/F,GAAKC,GAAKD,IAAMC,EACnB,OAAO,EAGT,IAAIiG,EAEJ,IAAKA,KAAKlG,EACR,KAAI+F,GAAuB,YAANG,IAKjBlG,EAAEkG,KAAOjG,EAAEiG,GACb,OAAO,EAIX,IAAKA,KAAKjG,EACR,KAAI8F,GAAuB,YAANG,GAKhBlG,EAAEkG,IACL,OAAO,EAIX,OAAO,EAQIC,CAAcH,EAAWD,EAAgB,EAAc,iBAAgBA,IAMtEC,EAAYD,EAAgB,EAAc,iBAE1CH,EAAO,YAPLR,EAAOS,IAAIC,gBAYzBV,EAAOS,IAAIO,SAAQ,WACjBR,OAMG,QAAe,WAAW,iBAAiB,sBAAiBS,G,gKCxE/Df,EAAU,GAEdA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IAElBF,EAAQG,OAAS,SAAc,KAAM,QAE3CH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB,IAE7B,IAAIC,EAAS,IAAI,UAASN,GAIxB,IAAK,kBAAkBF,EAAOS,IAAIC,WAAY,CAC5C,IA+BIC,GAAiB,iBACjBC,EAAYD,EAAgB,EAAc,iBAE9CX,EAAOS,IAAII,OACT,MACA,cApCkB,SAAuBjG,EAAGC,EAAG8F,GACnD,IAAK/F,GAAKC,GAAKD,IAAMC,EACnB,OAAO,EAGT,IAAIiG,EAEJ,IAAKA,KAAKlG,EACR,KAAI+F,GAAuB,YAANG,IAKjBlG,EAAEkG,KAAOjG,EAAEiG,GACb,OAAO,EAIX,IAAKA,KAAKjG,EACR,KAAI8F,GAAuB,YAANG,GAKhBlG,EAAEkG,IACL,OAAO,EAIX,OAAO,EAQIC,CAAcH,EAAWD,EAAgB,EAAc,iBAAgBA,IAMtEC,EAAYD,EAAgB,EAAc,iBAE1CH,EAAO,YAPLR,EAAOS,IAAIC,gBAYzBV,EAAOS,IAAIO,SAAQ,WACjBR,OAMG,QAAe,WAAW,iBAAiB,sBAAiBS","sources":["webpack://@dev/app/../client/src/index.ts","webpack://@dev/app/../sensor/src/services/SensorService.ts","webpack://@dev/app/../sensor/src/services/index.ts","webpack://@dev/app/../web/src/containers/Sensor/Measurements/index.tsx","webpack://@dev/app/../web/src/containers/Sensor/index.tsx","webpack://@dev/app/../web/src/containers/Sensor/Measurements/styles.module.scss","webpack://@dev/app/../web/src/containers/Sensor/styles.module.scss","webpack://@dev/app/../web/src/containers/Sensor/Measurements/styles.module.scss?6085","webpack://@dev/app/../web/src/containers/Sensor/styles.module.scss?7c0d"],"sourcesContent":["import { GraphQLClient } from \"graphql-request\";\nimport { createClient } from \"graphql-ws\";\n\n// https://shammelburg.medium.com/subscriptions-with-graphql-dfa8279af050\n// https://github.com/shammelburg/graphql-rxjs-angular/blob/main/src/app/services/graphql.service.ts\nexport const client = new GraphQLClient(`${location.pathname}graphql`, {\n  headers: {\n    // authorization: `Bearer ${localStorage.getItem('token')}`,\n  },\n});\n\nexport const subscriptions = createClient({\n  url: `${{ \"https:\": \"wss:\" }[location.protocol] || \"ws:\"}//${location.host}${\n    location.pathname\n  }subscriptions`,\n});\n","import { gql } from \"graphql-request\";\nimport { Observable, from } from \"rxjs\";\nimport { map } from \"rxjs/operators\";\nimport { client, subscriptions } from \"@dev/client\";\n\nconst ADD_MEASUREMENT = gql`\n  mutation AddMeasurement($measurement: MeasurementInput) {\n    addMeasurement(measurement: $measurement)\n  }\n`;\n\nconst REMOVE_MEASUREMENTS = gql`\n  mutation RemoveMeasurements($ids: [String]) {\n    removeMeasurements(ids: $ids)\n  }\n`;\n\nconst GET_MEASUREMENTS = gql`\n  query GetMeasurements {\n    getMeasurements {\n      date\n      temperature\n      humidity\n    }\n  }\n`;\n\nconst ON_SENSOR = gql`\n  subscription SensorSubscription {\n    sensor {\n      data\n    }\n  }\n`;\n\nexport class Service {\n  client = client;\n  subscriptions = subscriptions;\n}\n\nexport class SensorService extends Service {\n  addMeasurement(measurement) {\n    return from(this.client.request(ADD_MEASUREMENT, { measurement }));\n  }\n\n  removeMeasurements(ids) {\n    return from(this.client.request(REMOVE_MEASUREMENTS, { ids }));\n  }\n\n  getMeasurements() {\n    return from(this.client.request(GET_MEASUREMENTS)).pipe(\n      map(({ getMeasurements }) => getMeasurements)\n    );\n  }\n\n  onSensor() {\n    return new Observable((observer) =>\n      this.subscriptions.subscribe(\n        { query: ON_SENSOR },\n        {\n          next: ({ data, errors }) =>\n            errors ? observer.error(errors[0]) : observer.next(data),\n          error: (error) => observer.error(error),\n          complete: () => observer.complete(),\n        }\n      )\n    );\n  }\n}\n","import { useEffect, useState } from \"react\";\nimport { SensorService } from \"./SensorService\";\n\nconst sensorService = new SensorService();\n\nexport function useSensor() {\n  const [{ measurements, values }, setState] = useState(() => ({\n    measurements: null,\n    values: null,\n  }));\n\n  useEffect(() => {\n    const subscriptions = [\n      sensorService.onSensor().subscribe(({ sensor }) =>\n        setState(({ values, ...state }) => ({\n          ...state,\n          values: (values || []).concat([sensor]),\n        }))\n      ),\n    ];\n\n    sensorService\n      .getMeasurements()\n      .subscribe((measurements) =>\n        setState((state) => ({ ...state, measurements }))\n      );\n\n    return () => {\n      subscriptions.map((it) => it.unsubscribe());\n    };\n  }, []);\n\n  return [\n    { measurements, values },\n    {\n      addMeasurement: (data) => sensorService.addMeasurement(data),\n      removeMeasurements: (data) => sensorService.removeMeasurements(data),\n    },\n  ];\n}\n","import React, {\n  ChangeEventHandler,\n  MouseEventHandler,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { format } from \"date-fns\";\nimport styles from \"./styles.module.scss\";\n\nexport type Measurement = {\n  id: string;\n  date: number;\n  temperature: number;\n  humidity: number;\n};\n\nfunction Measurements({\n  removeMeasurements,\n  measurements,\n}: {\n  measurements: Measurement[];\n}) {\n  const [selected, setSelected] = useState<string[]>(() => []);\n\n  return (\n    <section className={styles.Measurements}>\n      <table>\n        <tbody>\n          <tr>\n            <th>\n              <input\n                type=\"checkbox\"\n                checked={selected.length === measurements.length}\n                onChange={useCallback<ChangeEventHandler<HTMLInputElement>>(\n                  ({ target }) =>\n                    setSelected(\n                      target.checked ? measurements.map(({ id }) => id) : []\n                    ),\n                  []\n                )}\n              />\n            </th>\n            <th>Date</th>\n            <th>Temperature</th>\n            <th>Humidity</th>\n          </tr>\n          {measurements.map((item, i) => [\n            <tr key={i}>\n              <td>\n                <input\n                  type=\"checkbox\"\n                  checked={selected.includes(item.id)}\n                  onChange={useCallback<ChangeEventHandler<HTMLInputElement>>(\n                    ({ target }) =>\n                      setSelected((selected) =>\n                        !target.checked\n                          ? selected.filter((id) => id !== item.id)\n                          : selected.concat(item.id)\n                      ),\n                    []\n                  )}\n                />\n              </td>\n              <td>{format(Number(item.date), \"yyyy-MM-dd, HH:mm:ss\")}</td>\n              <td align=\"right\">\n                {`${new Intl.NumberFormat(\"pl-PL\", {\n                  minimumFractionDigits: 2,\n                }).format(item.temperature)}°C`}\n              </td>\n              <td align=\"right\">\n                {`${new Intl.NumberFormat(\"pl-PL\", {\n                  minimumFractionDigits: 2,\n                }).format(item.humidity)}%`}\n              </td>\n            </tr>,\n          ])}\n        </tbody>\n      </table>\n      <button\n        disabled={selected.length === 0}\n        onClick={useCallback<MouseEventHandler>(\n          () => removeMeasurements(selected),\n          [selected]\n        )}\n      >\n        removeMeasurements\n      </button>\n    </section>\n  );\n}\n\nexport default function Sensor({\n  addMeasurement,\n  removeMeasurements,\n  measurements,\n}) {\n  const list = useMemo(\n    () =>\n      measurements &&\n      measurements\n        .map((item) => ({ id: item.date, date: Number(item.date), ...item }))\n        .sort((a, b) => b.date - a.date),\n    [measurements]\n  );\n\n  return (\n    <section>\n      <span>Measurements</span>\n      <button\n        onClick={useCallback<MouseEventHandler>(\n          () =>\n            addMeasurement({ date: Date.now(), temperature: 22, humidity: 60 }),\n          []\n        )}\n      >\n        addMeasurement\n      </button>\n      {measurements === null ? (\n        <div>Loading...</div>\n      ) : (\n        <Measurements\n          removeMeasurements={removeMeasurements}\n          measurements={list}\n        />\n      )}\n    </section>\n  );\n}\n","import React, { MouseEventHandler, useCallback, useEffect } from \"react\";\nimport { useSensor } from \"@dev/sensor/src/services\";\nimport Measurements from \"./Measurements\";\nimport styles from \"./styles.module.scss\";\n\n// https://github.com/atc1441/atc1441.github.io/blob/master/TelinkFlasher.html\nconst addLog = console.log;\nconst addClog = addLog;\nconst setStatus = addLog;\n\nfunction handleError(error) {\n  console.error(error);\n  // resetVariables();\n  // if (connectTrys < 5) {\n  //     connectTrys++;\n  //     addLog(\"Reconnect \" + connectTrys + \" from \" + 5);\n  //     doConnect();\n  // } else {\n  //     addLog(\"Something went wrong, to many reconnect's\");\n  //     connectTrys = 0;\n  // }\n}\n\nfunction onDisconnected() {\n  console.log(\"Disconnected.\");\n}\n\nfunction catchAdvertisement(device) {\n  const abortController = new AbortController();\n  device.addEventListener(\n    \"advertisementreceived\",\n    (event) => {\n      console.log('Received advertisement from \"' + device.name + '\"...');\n      event.serviceData.forEach((valueDataView) => {\n        const buffer = new Uint8Array(valueDataView.buffer);\n        console.log(buffer, device, event);\n        if (device.name == \"LYWSD03MMC\") {\n          console.log(\n            \"LYWSD03MMC MAC:\",\n            buffer[10].toString(16),\n            buffer[9].toString(16),\n            buffer[8].toString(16),\n            buffer[7].toString(16),\n            buffer[6].toString(16),\n            buffer[5].toString(16)\n          );\n          document.getElementById(\"MAC\").innerHTML =\n            \"LYWSD03MMC MAC: \" +\n            buffer[10].toString(16) +\n            buffer[9].toString(16) +\n            buffer[8].toString(16) +\n            buffer[7].toString(16) +\n            buffer[6].toString(16) +\n            buffer[5].toString(16);\n        }\n        if (device.name.startsWith(\"ATC\")) {\n          console.log(\n            \"ATC MAC:\",\n            buffer[0].toString(16),\n            buffer[1].toString(16),\n            buffer[2].toString(16),\n            buffer[3].toString(16),\n            buffer[4].toString(16),\n            buffer[5].toString(16)\n          );\n          document.getElementById(\"MAC\").innerHTML =\n            \"ATC MAC: \" +\n            buffer[0].toString(16) +\n            buffer[1].toString(16) +\n            buffer[2].toString(16) +\n            buffer[3].toString(16) +\n            buffer[4].toString(16) +\n            buffer[5].toString(16);\n        } else {\n          console.log(\"only LYWSD03MMC/ATC supported\");\n        }\n      });\n      abortController.abort();\n    },\n    { once: true }\n  );\n}\n\nlet ServiceMain;\nlet writeCharacteristicSpeed;\nlet nitifiyCharTemp;\n\nfunction miAction(addMeasurement) {\n  gattServer\n    .getPrimaryService(\"ebe0ccb0-7a0a-4b0c-8a1a-6ff2997da3a6\")\n    .then((service) => {\n      addClog(\"Found Main service\");\n      ServiceMain = service;\n      return ServiceMain.getCharacteristic(\n        \"ebe0ccd8-7a0a-4b0c-8a1a-6ff2997da3a6\"\n      );\n    })\n    .then((characteristic) => {\n      addClog(\"Found Write characteristic Speed\");\n      writeCharacteristicSpeed = characteristic;\n      return ServiceMain.getCharacteristic(\n        \"ebe0ccc1-7a0a-4b0c-8a1a-6ff2997da3a6\"\n      );\n    })\n    .then((characteristic) => {\n      addClog(\"Found Temp characteristic\");\n      nitifiyCharTemp = characteristic;\n      return nitifiyCharTemp.startNotifications().then(() => {\n        nitifiyCharTemp.addEventListener(\n          \"characteristicvaluechanged\",\n          (event) => {\n            var value = event.target.value;\n            console.log({ value });\n            var sign = value.getUint8(1) & (1 << 7);\n            var temp = ((value.getUint8(1) & 0x7f) << 8) | value.getUint8(0);\n            if (sign) temp = temp - 32767;\n            temp = temp / 100;\n            var humi = value.getUint8(2);\n            var tempTempString = \"Temp/Humi: \" + temp + \"°C / \" + humi + \"%\";\n            document.getElementById(\"tempHumiData\").innerHTML = tempTempString;\n            addClog(tempTempString);\n            addMeasurement({\n              date: Date.now(),\n              temperature: temp,\n              humidity: humi,\n            });\n          }\n        );\n        // miAuthorization()\n      });\n    })\n    .catch(handleError);\n}\n\nlet bluetoothDevice = null;\nlet gattServer;\nlet Theservice;\nlet writeCharacteristic;\n\nfunction doConnect(addMeasurement) {\n  bluetoothDevice.gatt\n    .connect()\n    .then((server) => {\n      addClog(\"Found GATT server\");\n      gattServer = server;\n      return gattServer.getPrimaryService(\n        \"00010203-0405-0607-0809-0a0b0c0d1912\"\n      );\n    })\n    .then((service) => {\n      addClog(\"Found service\");\n      Theservice = service;\n      return Theservice.getCharacteristic(\n        \"00010203-0405-0607-0809-0a0b0c0d2b12\"\n      );\n    })\n    .then((characteristic) => {\n      addClog(\"Found write characteristic\");\n      writeCharacteristic = characteristic;\n      detectMi(addMeasurement);\n    })\n    .catch(handleError);\n}\n\nlet miEnabled;\nlet customEnabled;\n\nfunction detectMi(addMeasurement) {\n  gattServer\n    .getPrimaryServices()\n    .then((services) => {\n      miEnabled = false;\n      customEnabled = false;\n      for (var i = 0; i < services.length; i++) {\n        console.log(\"Services: \" + services[i].uuid);\n        if (services[i].uuid == \"ebe0ccb0-7a0a-4b0c-8a1a-6ff2997da3a6\")\n          miEnabled = true;\n        if (services[i].uuid == \"00001f10-0000-1000-8000-00805f9b34fb\")\n          customEnabled = true;\n      }\n      if (miEnabled) {\n        addLog(\"Detected Mi Thermometer\");\n        setStatus(\"Detected Mi Thermometer\");\n        miAction(addMeasurement);\n      } else if (customEnabled) {\n        addLog(\"Detected custom Firmware\");\n        setStatus(\"Detected custom Firmware\");\n        // customAction();\n      } else {\n        addLog(\"Connected\");\n        setStatus(\"Connected\");\n      }\n    })\n    .catch(handleError);\n}\n\nexport default function Sensor() {\n  const [{ measurements, values }, { addMeasurement, removeMeasurements }] =\n    useSensor();\n  console.log({ measurements, values });\n\n  useEffect(() => {}, []);\n\n  const onReconnect = useCallback<MouseEventHandler<HTMLButtonElement>>(\n    (event) => {\n      if (bluetoothDevice !== null) bluetoothDevice.gatt.disconnect();\n      // resetVariables();\n      addLog(\"Reconnect\");\n      // connectTrys = 0;\n      doConnect(addMeasurement);\n    },\n    [addMeasurement]\n  );\n\n  const onConnect = useCallback<MouseEventHandler<HTMLButtonElement>>(\n    (event) => {\n      // https://developer.mozilla.org/en-US/docs/Web/API/Bluetooth/requestDevice\n      const deviceOptions = {\n        filters: [\n          { name: \"LYWSD03MMC\" },\n          {\n            services: [0xfe95],\n          },\n          // {\n          //   services: [\n          //     \"00010203-0405-0607-0809-0a0b0c0d1912\",\n          //     \"ebe0ccb0-7a0a-4b0c-8a1a-6ff2997da3a6\",\n          //     0xfe95,\n          //     0x1f10,\n          //   ],\n          // },\n        ],\n        optionalServices: [\n          \"00010203-0405-0607-0809-0a0b0c0d1912\",\n          \"ebe0ccb0-7a0a-4b0c-8a1a-6ff2997da3a6\",\n          0xfe95,\n          0x1f10,\n        ],\n        // acceptAllDevices: true,\n      };\n      navigator.bluetooth.getAvailability().then((availability) => {\n        if (availability) {\n          // https://developer.mozilla.org/en-US/docs/Web/API/BluetoothCharacteristicProperties#examples\n          navigator.bluetooth\n            .requestDevice(deviceOptions)\n            .then((device) => {\n              console.log({ device });\n              bluetoothDevice = device;\n              catchAdvertisement(device);\n              bluetoothDevice.addEventListener(\n                \"gattserverdisconnected\",\n                onDisconnected\n              );\n              addLog(\"Connecting to: \" + bluetoothDevice.name);\n              doConnect(addMeasurement);\n            })\n            .catch(handleError);\n        }\n      });\n    },\n    [addMeasurement]\n  );\n\n  return (\n    <section className={styles.Section}>\n      <span>LYWSD03MMC</span>\n      <button onClick={onConnect}>Connect</button>\n      <button onClick={onReconnect}>Reconnect</button>\n      <Measurements\n        addMeasurement={addMeasurement}\n        removeMeasurements={removeMeasurements}\n        measurements={measurements}\n      />\n      <span id=\"tempHumiData\"></span>\n      <span id=\"MAC\"></span>\n      {values === null ? (\n        <div>Loading...</div>\n      ) : (\n        values.map((item, key) => <div key={key}>{JSON.stringify(item)}</div>)\n      )}\n    </section>\n  );\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".zVsfBLYd_QBXGtNvyP3i{font-family:Arial,Helvetica,sans-serif;font-size:.7em}.zVsfBLYd_QBXGtNvyP3i table{border-collapse:collapse}.zVsfBLYd_QBXGtNvyP3i table tr:hover{background-color:#e0e0e0}.zVsfBLYd_QBXGtNvyP3i tr:nth-child(even){background-color:#f7f7f7}.zVsfBLYd_QBXGtNvyP3i th,.zVsfBLYd_QBXGtNvyP3i td{padding:.25em}\", \"\",{\"version\":3,\"sources\":[\"webpack://./../web/src/containers/Sensor/Measurements/styles.module.scss\"],\"names\":[],\"mappings\":\"AAAA,sBACE,sCAAA,CACA,cAAA,CACA,4BACE,wBAAA,CAEE,qCACE,wBAAA,CAKJ,yCACE,wBAAA,CAGJ,kDAEE,aAAA\",\"sourcesContent\":[\".Measurements {\\n  font-family: Arial, Helvetica, sans-serif;\\n  font-size: 0.7em;\\n  table {\\n    border-collapse: collapse;\\n    tr {\\n      &:hover {\\n        background-color: #e0e0e0;\\n      }\\n    }\\n  }\\n  tr {\\n    &:nth-child(even) {\\n      background-color: #f7f7f7;\\n    }\\n  }\\n  th,\\n  td {\\n    padding: 0.25em;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"Measurements\": \"zVsfBLYd_QBXGtNvyP3i\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".BUVMpFXG9cmk5ZtAw0Oh{color:purple}\", \"\",{\"version\":3,\"sources\":[\"webpack://./../web/src/containers/Sensor/styles.module.scss\"],\"names\":[],\"mappings\":\"AAAA,sBACE,YAAA\",\"sourcesContent\":[\".Section {\\n  color: purple;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"Section\": \"BUVMpFXG9cmk5ZtAw0Oh\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\nif (module.hot) {\n  if (!content.locals || module.hot.invalidate) {\n    var isEqualLocals = function isEqualLocals(a, b, isNamedExport) {\n  if (!a && b || a && !b) {\n    return false;\n  }\n\n  var p;\n\n  for (p in a) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (a[p] !== b[p]) {\n      return false;\n    }\n  }\n\n  for (p in b) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (!a[p]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n    var isNamedExport = !content.locals;\n    var oldLocals = isNamedExport ? namedExport : content.locals;\n\n    module.hot.accept(\n      \"!!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\",\n      function () {\n        if (!isEqualLocals(oldLocals, isNamedExport ? namedExport : content.locals, isNamedExport)) {\n                module.hot.invalidate();\n\n                return;\n              }\n\n              oldLocals = isNamedExport ? namedExport : content.locals;\n\n              update(content);\n      }\n    )\n  }\n\n  module.hot.dispose(function() {\n    update();\n  });\n}\n\n\nexport * from \"!!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","\n      import API from \"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\nif (module.hot) {\n  if (!content.locals || module.hot.invalidate) {\n    var isEqualLocals = function isEqualLocals(a, b, isNamedExport) {\n  if (!a && b || a && !b) {\n    return false;\n  }\n\n  var p;\n\n  for (p in a) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (a[p] !== b[p]) {\n      return false;\n    }\n  }\n\n  for (p in b) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (!a[p]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n    var isNamedExport = !content.locals;\n    var oldLocals = isNamedExport ? namedExport : content.locals;\n\n    module.hot.accept(\n      \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\",\n      function () {\n        if (!isEqualLocals(oldLocals, isNamedExport ? namedExport : content.locals, isNamedExport)) {\n                module.hot.invalidate();\n\n                return;\n              }\n\n              oldLocals = isNamedExport ? namedExport : content.locals;\n\n              update(content);\n      }\n    )\n  }\n\n  module.hot.dispose(function() {\n    update();\n  });\n}\n\n\nexport * from \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n       export default content && content.locals ? content.locals : undefined;\n"],"names":["client","GraphQLClient","location","pathname","headers","subscriptions","createClient","url","protocol","host","ADD_MEASUREMENT","gql","REMOVE_MEASUREMENTS","GET_MEASUREMENTS","ON_SENSOR","sensorService","addMeasurement","measurement","from","this","request","removeMeasurements","ids","getMeasurements","pipe","map","onSensor","Observable","observer","subscribe","query","next","data","errors","error","complete","Measurements","measurements","selected","setSelected","useState","className","styles","type","checked","length","onChange","useCallback","target","id","item","i","key","includes","concat","filter","format","Number","date","align","Intl","NumberFormat","minimumFractionDigits","temperature","humidity","disabled","onClick","Sensor","list","useMemo","sort","a","b","Date","now","addLog","console","log","addClog","setStatus","handleError","onDisconnected","ServiceMain","writeCharacteristicSpeed","nitifiyCharTemp","gattServer","Theservice","writeCharacteristic","miEnabled","customEnabled","bluetoothDevice","doConnect","gatt","connect","then","server","getPrimaryService","service","getCharacteristic","characteristic","getPrimaryServices","services","uuid","startNotifications","addEventListener","event","value","sign","getUint8","temp","humi","tempTempString","document","getElementById","innerHTML","catch","miAction","detectMi","values","setState","useEffect","sensor","state","it","unsubscribe","useSensor","onReconnect","disconnect","onConnect","deviceOptions","filters","name","optionalServices","navigator","bluetooth","getAvailability","availability","requestDevice","device","abortController","AbortController","serviceData","forEach","valueDataView","buffer","Uint8Array","toString","startsWith","abort","once","catchAdvertisement","JSON","stringify","___CSS_LOADER_EXPORT___","push","module","locals","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","update","hot","invalidate","isNamedExport","oldLocals","accept","p","isEqualLocals","dispose","undefined"],"sourceRoot":""}