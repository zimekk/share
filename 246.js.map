{"version":3,"file":"246.js","mappings":"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","sources":["webpack://@dev/app/../client/src/index.ts","webpack://@dev/app/../talks/src/services/Service.ts","webpack://@dev/app/../talks/src/services/BrowserService.ts","webpack://@dev/app/../talks/src/services/MessagesService.ts","webpack://@dev/app/../talks/src/services/SensorService.ts","webpack://@dev/app/../talks/src/services/index.ts","webpack://@dev/app/../web/src/containers/Browser/index.tsx","webpack://@dev/app/../web/src/containers/Browser/styles.module.scss","webpack://@dev/app/../web/src/containers/Browser/styles.module.scss?9f3b"],"sourcesContent":["import { GraphQLClient } from \"graphql-request\";\nimport { createClient } from \"graphql-ws\";\n\n// https://shammelburg.medium.com/subscriptions-with-graphql-dfa8279af050\n// https://github.com/shammelburg/graphql-rxjs-angular/blob/main/src/app/services/graphql.service.ts\nexport const client = new GraphQLClient(`${location.pathname}graphql`, {\n  headers: {\n    // authorization: `Bearer ${localStorage.getItem('token')}`,\n  },\n});\n\nexport const subscriptions = createClient({\n  url: `${{ \"https:\": \"wss:\" }[location.protocol] || \"ws:\"}//${location.host}${\n    location.pathname\n  }subscriptions`,\n});\n","import { client, subscriptions } from \"@dev/client\";\n\nexport class Service {\n  client = client;\n  subscriptions = subscriptions;\n}\n","import { gql } from \"graphql-request\";\nimport { from } from \"rxjs\";\nimport { Service } from \"./Service\";\n\nconst FILES = gql`\n  query {\n    files {\n      name\n    }\n  }\n`;\n\nexport class BrowserService extends Service {\n  files() {\n    return from(this.client.request(FILES));\n  }\n}\n","import { gql } from \"graphql-request\";\nimport { from, Observable } from \"rxjs\";\nimport { Service } from \"./Service\";\n\nconst MESSAGES = gql`\n  query MessagesQuery {\n    messages {\n      uuid\n      text\n    }\n  }\n`;\n\nconst ON_MESSAGE = gql`\n  subscription MessageSubscription {\n    message {\n      uuid\n      text\n    }\n  }\n`;\n\nconst SEND_MESSAGE = gql`\n  mutation SendMessageMutation($message: MessageInput) {\n    sendMessage(message: $message)\n  }\n`;\n\n// https://github.com/shammelburg/graphql-rxjs-angular/blob/main/src/app/services/graphql.service.ts\n// https://codesandbox.io/s/push-based-react-lab-3-vc8d6?file=/src/users/state/users.service.ts\n// https://jasonwatmore.com/post/2020/04/21/react-hooks-rxjs-communicating-between-components-with-observable-subject\nexport class MessagesService extends Service {\n  getMessages() {\n    return from(this.client.request(MESSAGES));\n  }\n  sendMessage(message) {\n    return from(this.client.request(SEND_MESSAGE, { message }));\n  }\n  onMessage() {\n    return new Observable((observer) =>\n      this.subscriptions.subscribe(\n        { query: ON_MESSAGE },\n        {\n          next: ({ data, errors }) =>\n            errors ? observer.error(errors[0]) : observer.next(data),\n          error: (error) => observer.error(error),\n          complete: () => observer.complete(),\n        }\n      )\n    );\n  }\n}\n","import { gql } from \"graphql-request\";\nimport { Observable } from \"rxjs\";\nimport { Service } from \"./Service\";\n\nconst ON_SENSOR = gql`\n  subscription SensorSubscription {\n    sensor {\n      data\n    }\n  }\n`;\n\nexport class SensorService extends Service {\n  onSensor() {\n    return new Observable((observer) =>\n      this.subscriptions.subscribe(\n        { query: ON_SENSOR },\n        {\n          next: ({ data, errors }) =>\n            errors ? observer.error(errors[0]) : observer.next(data),\n          error: (error) => observer.error(error),\n          complete: () => observer.complete(),\n        }\n      )\n    );\n  }\n}\n","import { useEffect, useState } from \"react\";\nimport { BrowserService } from \"./BrowserService\";\nimport { MessagesService } from \"./MessagesService\";\nimport { SensorService } from \"./SensorService\";\n\nconst messageService = new MessagesService();\n\n// https://codesandbox.io/s/push-based-react-lab-3-vc8d6?file=/src/users/hooks/users.hook.ts\nexport function useMessages() {\n  const [{ messages }, setState] = useState(() => ({\n    messages: null,\n  }));\n\n  useEffect(() => {\n    const subscriptions = [\n      messageService\n        .getMessages()\n        .subscribe(({ messages }) =>\n          setState((state) => ({ ...state, messages }))\n        ),\n      messageService.onMessage().subscribe(({ message }) =>\n        setState(({ messages, ...state }) => ({\n          ...state,\n          messages: messages.concat([message]),\n        }))\n      ),\n    ];\n    return () => {\n      subscriptions.map((it) => it.unsubscribe());\n    };\n  }, []);\n\n  return [\n    { messages },\n    { sendMessage: (message) => messageService.sendMessage(message) },\n  ];\n}\n\nconst sensorService = new SensorService();\n\nexport function useSensor() {\n  const [{ values }, setState] = useState(() => ({\n    values: null,\n  }));\n\n  useEffect(() => {\n    const subscriptions = [\n      sensorService.onSensor().subscribe(({ sensor }) =>\n        setState(({ values, ...state }) => ({\n          ...state,\n          values: (values || []).concat([sensor]),\n        }))\n      ),\n    ];\n    return () => {\n      subscriptions.map((it) => it.unsubscribe());\n    };\n  }, []);\n\n  return [{ values }, {}];\n}\n\nconst browserService = new BrowserService();\n\nexport function useFiles() {\n  const [state, setState] = useState({ files: null });\n\n  useEffect(() => {\n    const subscriptions = [\n      browserService\n        .files()\n        .subscribe(({ files }) => setState((state) => ({ ...state, files }))),\n    ];\n    return () => {\n      subscriptions.map((it) => it.unsubscribe());\n    };\n  }, []);\n\n  return [state];\n}\n","import React from \"react\";\nimport { useFiles } from \"@dev/talks/src/services\";\nimport styles from \"./styles.module.scss\";\n\nexport default function Browser() {\n  const [{ files }] = useFiles();\n\n  return (\n    <section className={styles.Browser}>\n      {files === null ? (\n        <div>Loading...</div>\n      ) : (\n        files.map(({ name }, key) => <div key={key}>{name}</div>)\n      )}\n    </section>\n  );\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".PhiGUjmUXa9MRAmc3aNA{color:purple}\", \"\",{\"version\":3,\"sources\":[\"webpack://./../web/src/containers/Browser/styles.module.scss\"],\"names\":[],\"mappings\":\"AAAA,sBACE,YAAA\",\"sourcesContent\":[\".Browser {\\n  color: purple;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"Browser\": \"PhiGUjmUXa9MRAmc3aNA\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\nif (module.hot) {\n  if (!content.locals || module.hot.invalidate) {\n    var isEqualLocals = function isEqualLocals(a, b, isNamedExport) {\n  if (!a && b || a && !b) {\n    return false;\n  }\n\n  var p;\n\n  for (p in a) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (a[p] !== b[p]) {\n      return false;\n    }\n  }\n\n  for (p in b) {\n    if (isNamedExport && p === \"default\") {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (!a[p]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n    var isNamedExport = !content.locals;\n    var oldLocals = isNamedExport ? namedExport : content.locals;\n\n    module.hot.accept(\n      \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\",\n      function () {\n        if (!isEqualLocals(oldLocals, isNamedExport ? namedExport : content.locals, isNamedExport)) {\n                module.hot.invalidate();\n\n                return;\n              }\n\n              oldLocals = isNamedExport ? namedExport : content.locals;\n\n              update(content);\n      }\n    )\n  }\n\n  module.hot.dispose(function() {\n    update();\n  });\n}\n\n\nexport * from \"!!../../../../../node_modules/css-loader/dist/cjs.js!../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./styles.module.scss\";\n       export default content && content.locals ? content.locals : undefined;\n"],"names":["client","GraphQLClient","location","pathname","headers","subscriptions","createClient","url","protocol","host","Service","FILES","gql","MESSAGES","ON_MESSAGE","SEND_MESSAGE","ON_SENSOR","messageService","getMessages","from","this","request","sendMessage","message","onMessage","Observable","observer","subscribe","query","next","data","errors","error","complete","useMessages","messages","setState","useState","useEffect","state","concat","map","it","unsubscribe","sensorService","onSensor","useSensor","values","sensor","browserService","files","useFiles","Browser","className","styles","name","key","___CSS_LOADER_EXPORT___","push","module","id","locals","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","update","hot","invalidate","isNamedExport","oldLocals","accept","a","b","p","isEqualLocals","dispose","undefined"],"sourceRoot":""}